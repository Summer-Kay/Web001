private Path resolveSecurePath(Path baseDir, String fileName) {
    // 验证文件名
    if (fileName == null || fileName.contains("..") || fileName.contains("/") || fileName.contains("\\")) {
        throw new SecurityException("Invalid file name: " + fileName);
    }
    
    Path resolvedPath = baseDir.resolve(fileName).normalize();
    
    // 安全检查
    if (!resolvedPath.startsWith(baseDir)) {
        throw new SecurityException("Path traversal detected: " + fileName);
    }
    
    return resolvedPath;
}

private File createSecureFolder(Path baseDir, String folderName) {
    Path folderPath = resolveSecurePath(baseDir, folderName);
    File folder = folderPath.toFile();
    if (!folder.exists()) {
        folder.mkdirs();
    }
    return folder;
}
